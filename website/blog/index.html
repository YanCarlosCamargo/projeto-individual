<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maker | Blog</title>
    <link rel="stylesheet" href="../styles/blogHome.css">
    <link rel="stylesheet" href="../styles/fonts.css">
    <link rel="stylesheet" href="../styles/teste.css">
</head>

<body>

    <div class="containerMain">
        <div class="navContainer">
            <div class="logoContainer">
                <img src="./assets/img/design/logo.png" alt="">
                <span id="logoText">MAKERBLOG</span>
            </div>

            <div class="containerLinksNav">

                <div class="linkNav">Oque é Arduino</div>
                <div class="linkNav">Oque é Arduino</div>
                <div class="linkNav">Oque é Arduino</div>

                <div class="perfilWrapper">
                    <div class="loginContainer linkNav" id="btnLogin">
                        <div class="btnLogin">Perfil</div>
                        <img src="assets/img/profile/profile.png" alt="">
                    </div>
                </div>
            </div>
        </div>

        <div class="containerConteudo">
            <div class="containerAbaLateral">
                <img id="imgProfileLateral" src="../assets/img/profile/profile.png" alt="">
                <label id="labelNome">Roberto Turbiani</label>
                <label class="labelTitulo">Mais Comentados</label>
            </div>

            <div class="containerFeed">

                <div class="wrapperPosts">
                    <input class="imgPostExpandido" id="input-file" placeholder="Escolha a imagem do seu Post"
                        type="file" accept="image/*"></input>
                    <div class="containerPostExpandido">
                        <div class="wrapperImgPostExpandido" id="wrapperImg">

                        </div>
                        <div class="wrapperInfoPostExpandido">
                            <div class="wrapperDataTituloExpandido">
                                <input placeholder="Insira o Titulo do post" class="tituloPostExpandido"></input>
                            </div>
                            <input type="text" placeholder="Insira a descrição do novo post"
                                class="descricaoPostExpandido">
                            </input>
                            <button class="btn-file">Selecione a imagem</button>
                            <button id="btnNewPost" onclick="newPost()">Publicar Novo Post</button>
                        </div>
                    </div>

                    <div id="wrapperNovoPost" class="wrapperNovoPost">
                        <p>Novo Post</p>
                    </div>

                    <div style="height: 50px; margin-top: 7%;"></div>
                    <span id="resultado" style="display: flex; align-items: center; flex-direction: column;">

                        <div class="containerPost">
                            <div class="wrapperImgPost">
                                <img class="imgPost" src="../assets/img/posts/post-example-1.png" alt="">
                            </div>
                            <div class="wrapperInfoPost">
                                <div class="wrapperDataTitulo">
                                    <div class="badgeData">
                                        05<br>
                                        06
                                    </div>
                                    <label class="tituloPost">Festa colorida Usando Fluido</label>
                                </div>
                                <label class="labelAutor">Por: zézin</label>
                                <label class="descricaoPost">é simplesmente um texto fictício da indústria tipográfica e
                                    de
                                    impressão. Lorem Ipsum tem sido o texto fictício padrão da indústria desde os anos
                                    1500,
                                    quando um impressor desconhecido pegou uma galera de tipos e os embaralhou para
                                    fazer um
                                    livro de espécimes de tipos. Ele sobreviveu não apenas a cinco séculos, mas também
                                    ao
                                    salto para a composição eletrônica, permanecendo essencialmente inalterado.
                                </label>
                                <div class="badgeLikesPost">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                        <path fill="red"
                                            d="m12 21.35l-1.45-1.32C5.4 15.36 2 12.27 2 8.5C2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53L12 21.35Z" />
                                    </svg>
                                    <label class="labelLikesPost">397</label>
                                </div>
                            </div>
                        </div>
                    </span>
                </div>
                <div class="wrapperNoticias">
                    sdfaf
                </div>
            </div>
        </div>

    </div>

    <script>
        const clientId = '83f26f78f9124b6';

        var wrapperNovoPost = document.getElementById('wrapperNovoPost');

        wrapperNovoPost.addEventListener('click', () => {
            wrapperNovoPost.style.display = 'none';
            document.querySelector('.containerPostExpandido').style.display = 'flex';
        })


        async function subirImagem(url, options) {
            console.log("subindo Imagem");
            const response = await fetch(url, options);
            const data = await response.json();
            console.log(data);
            return data;
        }
        const input = document.getElementById('input-file');
        const btn = document.querySelector('.btn-file');

        btn.addEventListener('click', () => {
            input.click();
        });

        input.addEventListener('change', () => {
            var img = input.files[0];
            console.log(img);
            wrapperImg.innerHTML = `<img class="imgPostExpandido" src="${URL.createObjectURL(img)}" alt="">`
        })

        async function newPost() {
            const titulo = document.querySelector('.tituloPostExpandido').value;
            const descricao = document.querySelector('.descricaoPostExpandido').value;
            const img = document.querySelector('.imgPostExpandido').src;

            var varFoto = new FormData();
            varFoto.append('image', document.getElementById('input-file').files[0]);

            const body = {
                idUsuario: 1,
                titulo,
                descricao,
                img
            }

            await subirImagem('https://api.imgur.com/3/upload', {
                method: 'POST',
                body: varFoto,
                headers: {
                    'Authorization': `Client-ID ${clientId}`,
                }
            }).then(data => {
                if (data.success) {
                    console.log("data Sucess??? ", data.success);
                    body.img = data.data.link;
                } else {
                    console.log("erro, não subiu a imagem", data);
                    return false
                }
            }).then(() => {
                fetch('/inserirPost', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body),
                }).then(response => {
                    console.log(response);
                    if (response.status == 200) {
                        console.log("post inserido com sucesso");
                        buscarPosts()
                    } else {
                        console.log("erro ao inserir post");
                    }
                })
            })
        }
        console.log("id sessão ", sessionStorage);

    </script>

    <script src="../js/listarPosts.js"></script>

</body>

</html>